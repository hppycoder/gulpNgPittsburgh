<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">

    <title>Building without boundaries with Gulp</title>

    <meta name="description"
          content="A presentation that was presented to ngPittsburgh in Pittsburgh, PA. This presentation explores how to use Gulp for all your build processes.">
    <meta name="author" content="Chad Smith">

    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>

    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">

    <link rel="stylesheet" href="css/reveal.css">
    <link rel="stylesheet" href="css/theme/black.css" id="theme">
    <link rel="stylesheet" href="css/theme/giftcards.css" id="theme">

    <!-- Code syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- Printing and PDF exports -->
    <script>
        var link = document.createElement('link');
        link.rel = 'stylesheet';
        link.type = 'text/css';
        link.href = window.location.search.match(/print-pdf/gi) ? 'css/print/pdf.css' : 'css/print/paper.css';
        document.getElementsByTagName('head')[0].appendChild(link);
    </script>

    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
</head>

<body>

<header>
    <div style="text-align:center;">
        <img class="logo" src="images/logoGiftCards.png" alt="GiftCards Logo">
    </div>
    <div class="smiling-g"></div>
</header>
<div class="reveal">

    <!-- Any section element inside of this container is displayed as a slide -->
    <div class="slides">
        <section>
            <h1>Building without boundaries with Gulp</h1>

            <aside class="notes">
                <strong>Thanks for having me ngPittsburgh!</strong>
                <ul>
                    <li>Absolutely great to be here!</li>
                    <li>I wanted to give a presentation on how my team at GiftCards.com is using Gulp in our production environment</li>
                    <li>The code presented in this presentation is 100% used in our daily builds</li>
                    <li>Gulp is great in that it gives way to a whole new exciting experience! You don't need to do manual work for minifcation, or the dull tasks that you should already be doing!</li>
                    <li>This talk is going to be for everyone, but I have geared specific examples for AngularJS.</li>
                </ul>
            </aside>
        </section>
        <section>
            <h2>Why Use a build tool?</h2>
            <ul>
                <li>Automation</li>
                <li>Predictability</li>
                <li>Performance</li>
            </ul>
            <aside class="notes">
                <strong>Developers have to do a LOT!</strong>
                <ul>
                    <li>We have to focus on performance, scalability, and we have to make our clients/customers happy.</li>
                    <li>We have to make sure that our code doesn't get penalized by Google</li>
                    <li>We have to make it easier to develop!</li>
                    <li>We have to do all these things that are changing all the time</li>
                    <li>We <strong>know</strong> what we should do, but we need something that we automate</li>
                </ul>
            </aside>
        </section>

        <section>
            <h2>What is Gulp?</h2>
            <div>
                <div style="float:left; width:60%;">
                    <ul>
                        <li>Node based</li>
                        <li>Memory</li>
                        <li>Asynchronous</li>
                        <li>Extensible</li>
                        <li>5,740+ modules</li>
                    </ul>
                </div>
                <div style="float:left; width:40%">
                    <img src="images/gulp-2x.png" style="width:30%; border: none; box-shadow:none;" />
                </div>
            </div>

            <aside class="notes">Gulp is a Node based build system built on extensibility and efficiency. It has hundreds of downloads an hour on the NPM network and most of what you have done with Grunt can be converted to Gulp.</aside>
        </section>

        <section>
            <h2>Getting Started</h2>
            <ul>
                <li>Plan ahead</li>
                <li>File writing strategy</li>
                <li>Deployment strategy</li>
            </ul>
        </section>
        <section>
            <h2>Plan Ahead</h2>
            <ul>
                <li>List what you do manually</li>
                <li>Find modules to help automate</li>
                <li>What is considered a &quot;failed&quot; build</li>
                <li>Start making your gulpfile</li>
                <li>Keep updating</li>
            </ul>
        </section>
        <section>
            <h2>File Writing Strategy</h2>
            <ul>
                <li>Move files</li>
                <li>Edit sources</li>
                <li>Add to sources</li>
            </ul>
        </section>
        <section>
            <h2>Deployment Process</h2>
            <ul>
                <li>What will run gulp?</li>
                <li>Error handling</li>
                <li>Automation</li>
            </ul>
        </section>

        <section>
            <section>
                <h2>Getting Setup</h2>
                <p>Install Gulp globally</p>
                <pre><code>
$ npm install -g gulp
                </code></pre>
            </section>
            <section>
                <h3>Include in package.json</h3>
                <pre><code>
{
  "name": "giftcards-gulp",
  "version": "0.0.0",
  "dependencies": {
    "gulp": "^3.8.10",
    "gulp-bower": "~0.0.6"
  }
}
                    </code></pre>
            </section>
            <section>
                <h2>Sample gulpfile.js</h2>
                <pre><code>
var gulp = require('gulp');

gulp.task('moveFiles', function () {
  return gulp.src('./src/js/**/*.js').pipe(gulp.dest('./dist/js'));
});

gulp.task('dev', ['moveFiles']);
                    </code></pre>
            </section>
        </section>

        <section>
            <section>
                <h2>Common terminology</h2>
                <p>Review common functions used in Gulp which is the foundation to all Gulp files</p>
            </section>
            <section>
                <h2>Tasks</h2>
                <ul>
                    <li>Specifies a friendly name to functionality</li>
                    <li>Name cannot contain spaces</li>
                    <li>Can be used as a dependency for other tasks</li>
                    <li><strong>Must have a return</strong></li>
                </ul>
                <pre><code>
var gulp = require('gulp');
gulp.task(name, [], function() {
    return gulp.src(...).pipe(....);
});
                    </code></pre>
            </section>
            <section>
                <h2 style="text-transform: lowercase;">gulp.src</h2>
                <ul>
                    <li>Emits files that match glob patterns</li>
                    <li>Returns a stream of Vinyl files</li>
                    <li>Can include or exclude files with patterns</li>
                    <li>Glob patterns run in order defined</li>
                </ul>
                <pre><code>
gulp.src([
  './htdocs/+(app|fonts|js|css)/**',
  '!./htdocs/js/yui/**'
], {read: false})
                </code></pre>
            </section>
            <section>
                <h2 style="text-transform: lowercase;">pipe</h2>
                <ul>
                    <li>Pulls data out of the readable stream</li>
                    <li>Writes data to supplied destination</li>
                    <li>Manages data flow for fast moving streams</li>
                </ul>
            </section>
            <section>
                <h2 style="text-transform: lowercase;">gulp.dest</h2>
                <ul>
                    <li>Writes files to the relative path file system</li>
                    <li>Emits the same stream that was sent into it</li>
                    <li>Relative paths are calculated against base</li>
                </ul>
                <pre><code>
gulp.src('./js/**/*.js')
  .pipe(gulp.dest('./dist/js')
  .pipe(uglify())
  .pipe(gulp.dest('./dist/js/min');
                </code></pre>
            </section>
            <section>
                <h2>Dependencies</h2>

                <pre><code>
var gulp = require('gulp'),
    clean = require('gulp-clean');

gulp.task('cleanDist', function() {
  return gulp.src('./dist/**').pipe(clean());
});
gulp.task('distMove', ['cleanDist'], function () {
  return gulp.src('./js/**/*.js').pipe(gulp.dest('./dist/js'));
});
gulp.task('build', ['cleanDist','distMove']);
                </code></pre>
            </section>
            <section>
                <h2>Vinyl Streams and Adapters</h2>
                <ul>
                    <li>Stream is a collection of vinyl objects</li>
                    <li>Vinyl is the metadata behind the file</li>
                    <li>Vinyl Adapters are readers of the files that follow the interface src, dest, and watch</li>
                </ul>
            </section>
            <section>
                <h2>Plugins</h2>
                <p>Manipulates and returns vinyl streams with modified data</p>

                <pre><code>
var gulp = require('gulp'),
    ngAnnotate = require('gulp-ng-annotate'),
    uglify = require('gulp-uglify');

gulp.task('annotateCardBuild', function() {
  return gulp.src('./cardBuild/buildApp.js')
    .pipe(ngAnnotate())
    .pipe(uglify())
    .pipe(gulp.dest('./cardBuild'));
});
                </code></pre>
            </section>

        </section>

        <section>
            <h2>Gulp Watch</h2>
            <p>Given a glob pattern Gulp can run tasks when a file changes.</p>
            <p><strong>Once watch starts, new files will not be added.</strong></p>
            <pre><code>
var gulp = require('gulp');
gulp.task('watch', function () {
  gulp.watch('./sass/**/*.scss', ['compass', 'inject-dev']);
  gulp.watch('./js/**/*.js', ['minify-js', 'inject-dev']);
});
            </code></pre>
            <aside class="notes">
                <h3>WHY?</h3>
                <ul>
                    <li>Could keep all the code updated</li>
                    <li>Changes to JS could run jshint, karma, etc</li>
                    <li>Could recompile all the CSS</li>
                </ul>
            </aside>
        </section>

        <section>
            <h2>CSS Compilation</h2>
            <p>Compile all your CSS with your favorite pre-processor!</p>
            <pre><code>
var gulp = require('gulp'),
    plumber = require('gulp-plumber'),
    compass = require('gulp-compass');

gulp.task('compass', function () {
  return gulp.src('./sass/*.scss')
    .pipe(plumber())
    .pipe(compass({
      css: 'dist/css',
      sass: 'sass'
    }))
    .pipe(gulp.dest('dist/css'));
});
            </code></pre>

            <aside class="notes">
            <h3>WHY?</h3>
            <ul>
                <li>Want all your CSS to use something like SASS or LESS</li>
                <li>Gives designers more control using a pre-processor</li>
            </ul>
            </aside>
        </section>
        <section>
            <h2>Minify CSS</h2>
            <p>Thin wrapper to clean-css which optimizes CSS files</p>
            <pre><code>
var minifyCSS = require('gulp-minify-css');
gulp.task('minifyCSS', ['cardBuildLess'], function () {
  return gulp.src('./htdocs/css/**/*.css')
    .pipe(minifyCSS())
    .pipe(gulp.dest('./htdocs/css'));
});
            </code></pre>
            <aside class="notes">
                <h3>WHY?</h3>
                <ul>
                    <li>Smaller CSS files decreases bandwidth</li>
                </ul>
            </aside>
        </section>
        <section>
            <h2>Bower</h2>
            <p>Runs `bower install` with provided arguments and options. Returns Vinyl Stream with created files.</p>
            <pre><code>
var bower = require('gulp-bower');
gulp.task('bower', function () {
  return bower().pipe(gulp.dest('./bower_components'));
});
            </code></pre>
        </section>
        <section>
            <h2>UglifyJS</h2>
            <p>Takes a Vinyl Stream of JS files and runs through UglifyJS's native code with provided options.</p>
            <pre><code>
var uglify = require('gulp-uglify');
gulp.task('minifyCardBuildAssets', ['annotateBuild'], function() {
  return gulp.src(distPath + '/**/*.js')
    .pipe(uglify())
    .pipe(gulp.dest(distPath));
});
            </code></pre>
        </section>
        <section>
            <section>
                <h2>Arguments</h2>
                <p>Allows Gulp to take in arguments which can be used in the build process. Useful for passing in versions for instance.</p>
                <pre><code>
gulp build --ver=2.9.24-rc.5
                </code></pre>
            </section>
            <section>
                <h2>Arguments Example</h2>
                <pre><code>
var argv = require('yargs').argv;
if (argv.ver) {
  if (argv.ver.indexOf('-') > -1) {
    version = argv.ver.slice(0, argv.ver.indexOf('-'));
  } else {
    version = (argv.ver);
  }
} else {
  version = '0.0.0';
}
                </code></pre>
            </section>
        </section>
        <section>
            <h2>Merge Stream</h2>
            <p>Merges multiple process streams together and will finalize task when all streams are complete.</p>
            <div>
                <div style="float:left; width:60%">
                    <pre><code>
var merge = require('merge-stream');
gulp.task('moveFiles', function () {
  return merge(
    gulp.src('./js/**').pipe(gulp.dest('./dist/js')),
    gulp.src('./css/**').pipe(gulp.dest('./dist/css'))
  );
});
                    </code></pre>
                </div>
                <div style="float:left; width:40%">
                    <img src="images/mergeStreams.gif" style="border: none; box-shadow:none;" alt="" />
                </div>
            </div>
        </section>
        <section>
            <h2 style="text-transform: none;">ngAnnotate</h2>
            <p>This plugin will rewrite the AngularJS compiler passes to allow for the code to Uglified.</p>
            <p><strong>Formerly named: ngmin</strong></p>
            <pre><code>
var gulp = require('gulp'),
    ngAnnotate = require('gulp-ng-annotate'),
    uglify = require('gulp-uglify');

gulp.task('annotateBuild', ['buildAssets'], function() {
return gulp.src(cardBuildDistPath + '/cardBuild/buildApp.js')
  .pipe(ngAnnotate())
  .pipe(uglify())
  .pipe(gulp.dest(cardBuildDistPath + '/cardBuild'));
});
            </code></pre>
        </section>
        <section>
            <h2>Protractor</h2>
            <p>Have all your Protractor tests run with Gulp and provide feedback for failed builds.</p>
            <pre><code>
var gulp = require('gulp');
var cardBuildSrcPath = './src/cardbuild';
gulp.task('cardBuildE2ETests', function() {
  var protractor = require('gulp-protractor').protractor;
  gulp.src([cardBuildBasePath + '/test/e2e/*.js'])
    .pipe(protractor({
      configFile: cardBuildSrcPath+'/protractor.conf.js',
      args: ['--baseUrl', 'http://www.giftcards.com']
    }))
    .on('error', function(e) { throw e; });
});
            </code></pre>
        </section>
        <section>
            <h2>Karma Unit Tests</h2>
            <p>Modules: <em>karma</em>, <em>karma-jasmine</em>, <em>karma-phantomjs-launcher</em>, <em>karma-ng-html2js-preprocessor</em></p>
            <pre><code>
var gulp = require('gulp');
gulp.task('cardBuildUnitTests', ['bower'], function(done) {
  var karma = require('karma').server;
  karma.start({
    configFile: cardBuildBasePath + '/karma.conf.js',
    singleRun: false
  }, function(exitStatus){
    done(exitStatus ? 'Failing Unit Tests!' : undefined);
  });
});
            </code></pre>
        </section>
        <section>
            <div>
                <div style="float:left; width:60%;">
                    <ul>
                        <li>Deploy to your CDN (Cloudfiles,S3)</li>
                        <li>Run performance tests (psi)</li>
                        <li>Minify images! (gulp-imagemin)</li>
                        <li>Find unused CSS! (gulp-uncss)</li>
                        <li>Concatenate files (gulp-concat)</li>
                        <li>Auto-prefix CSS (gulp-autoprefixer)</li>
                        <li>SourceMap's? Oh yeah. (gulp-sourcemaps)</li>
                        <li>5,700+ other options!</li>
                    </ul>
                </div>
                <div style="float:left; width:40%">
                    <h2>GULP ALL THE THINGS</h2>
                    <img src="images/allthethings.jpg" style="border: none; box-shadow: none;" />
                </div>
            </div>
        </section>
        <section>
            <h2>Gulp's Scary Side</h2>
            <div>
                <div style="float:left; width:60%;">
                    <ul>
                        <li>Slower builds</li>
                        <li>Relying on 3rd party code</li>
                        <li>Dreadful error handling</li>
                        <li>One gulpfile to rule them all</li>
                    </ul>
                </div>
                <div style="float:left; width:40%;">
                    <img src="images/boo.gif" style="border: none; box-shadow:none;" />
                </div>
            </div>
        </section>

        <section>
            <section>
                <h2>Gulp not for you?</h2>
                <p>Alternatives to using Gulp</p>
                <ul>
                    <li>Make (Make)</li>
                    <li>Grunt (Node)</li>
                    <li>Broccoli (Node)</li>
                    <li>Brunch (Node)</li>
                    <li>Jake (Node)</li>
                    <li>Rake (Ruby)</li>
                    <li>NPM (Node)</li>
                </ul>
            </section>
            <section>
                <h2>Pure NPM</h2>
                <pre><code>
"devDependencies": {
  "jshint": "latest",
},
"scripts": {
  "lint": "jshint **.js"
}
                </code></pre>
            </section>
        </section>
        <section>
            <h2>Conclusion</h2>
            <p>Gulp is our build system that we use and trust. Find one that will work for you and your team and get started. With this presentation you learned the beginnings of how to put together a build system that will work for you.</p>
        </section>

        <section data-background="#f37021">
            <h2 style="color:#fff;">THANK YOU!</h2>

            <p style="color:#fff; padding-top:40px;">
                Chad Smith<br>
                Software Development Manager<br>
                chad.smith@giftcards.com<br>
                @hppycoder<br>
                <img src="images/GKnockout.png" style="border:0; background:initial; box-shadow: none;">
            </p>
        </section>

        <section>
            <section data-background="images/clap.gif" data-background-image="images/clap.gif">
                <h2>Questions?</h2>

            </section>
            <section>
                <img src="images/question.gif" style="border: none; box-shadow:none;" />
            </section>
        </section>

    </div>

</div>

<footer>
    <p>
        Examples: https://github.com/hppycoder/gulpNgPittsburgh<br>
        Slides: http://hppycoder.github.io/gulpNgPittsburgh<br>
        Chad Smith | @hppycoder | chad.smith@giftcards.com<br>
    </p>

</footer>

<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>

    // Full list of configuration options available at:
    // https://github.com/hakimel/reveal.js#configuration
    Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        transition: 'slide', // none/fade/slide/convex/concave/zoom

        // Optional reveal.js plugins
        dependencies: [
            {
                src: 'lib/js/classList.js', condition: function () {
                return !document.body.classList;
            }
            },
            {
                src: 'plugin/highlight/highlight.js', async: true, condition: function () {
                return !!document.querySelector('pre code');
            }, callback: function () {
                hljs.initHighlightingOnLoad();
            }
            },
            {src: 'plugin/zoom-js/zoom.js', async: true},
            {src: 'plugin/notes/notes.js', async: true}
        ]
    });

</script>

</body>
</html>